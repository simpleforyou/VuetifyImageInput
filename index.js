!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).VuetifyImageInput=e()}(this,(function(){"use strict";var t={functional:!0,render:function(t,e){let{listeners:i,parent:n,props:a}=e;return t("VBtn",{class:"ma-1",props:{disabled:n.disabled,flat:!0,icon:!0},on:i},[t("VIcon",{style:a.iconStyle},a.icon)])}};var e={functional:!0,render:function(t,e){let{parent:i}=e,{computedMaxScaling:n,computedMinScaling:a,disabled:r,scaleTo:l,scaling:o}=i;return t("VSlider",{class:"ma-1",props:{disabled:r,hideDetails:!0,max:n,min:a,step:.001,value:o},on:{input:l}})}};var i={on:function(){let{disabled:t}=this;if(t)return{};let{onClick:e,onDragEnter:i,onDragLeave:n,onDragOver:a,onDrop:r}=this;return{click:e,dragenter:i,dragleave:n,dragover:a,drop:r}}};function n(){}var a={load:function(t){var e;(e=()=>{this.cancel();let e=new FileReader,i=new Promise(((i,n)=>{e.addEventListener("progress",(e=>{let{loaded:i}=e;this.progress=i,this.$emit("progress",{file:t,loaded:i})})),e.addEventListener("load",(()=>{let{result:n}=e;Object.assign(this,{loaded:!0,result:n}),this.$emit("load",{file:t,result:n}),i()})),e.addEventListener("abort",(()=>{this.$emit("cancel",{file:t}),i()})),e.addEventListener("error",n)}));return e.readAsDataURL(t),Object.assign(this,{cancel:()=>{1===e.readyState&&e.abort()},error:null,failed:!1,file:t,loaded:!1,loading:!0,progress:0,result:null}),i},new Promise((t=>{t(e())}))).catch((e=>{Object.assign(this,{error:e,failed:!0}),this.$emit("error",{error:e,file:t})})).finally((()=>{Object.assign(this,{cancel:n,loading:!1})}))},onChange:function(t){t.preventDefault();let{files:e}=t.target;e&&e.length&&this.load(e[0])},onClick:function(t){t.preventDefault();let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept",this.$parent.$props.accept);let{onChange:i}=this;e.addEventListener("change",i),e.click()},onDragEnter:function(t){t.preventDefault(),this.dragging=!0},onDragLeave:function(t){t.preventDefault(),this.dragging=!1},onDragOver:function(t){t.preventDefault()},onDrop:function(t){t.preventDefault(),this.dragging=!1;let{files:e}=t.dataTransfer;e&&e.length&&this.load(e[0])}};var r={props:{disabled:{type:Boolean,default:!1},accept:{type:String,default:"image/*"}},data:function(){return{cancel:n,dragging:!1,error:null,failed:!1,file:null,loaded:!1,loading:!1,progress:0,result:null}},computed:i,methods:a,render:function(){let{$scopedSlots:t,cancel:e,dragging:i,error:n,failed:a,file:r,loaded:l,loading:o,on:s,progress:d,result:c}=this;return t.default({cancel:e,dragging:i,error:n,failed:a,file:r,loaded:l,loading:o,on:s,progress:d,result:c})}};var l={functional:!0,render:function(t,e){let{data:i,listeners:n,parent:a}=e,{disabled:l,errorIcon:o,errorIconStyle:s,successIcon:d,successIconStyle:c,uploadIcon:g,uploadIconStyle:p}=a,{load:u}=n,{style:h}=i;return t(r,{style:h,props:{disabled:l},scopedSlots:{default:e=>{let{dragging:i,failed:n,file:a,loaded:r,loading:u,on:h,progress:f}=e;return t("VCard",{style:{alignItems:"center",display:"flex",height:"100%",justifyContent:"center",width:"100%"},props:{disabled:l,outlined:!0},on:h},[(()=>{if(u){let e,i,n=f/a.size*100;return n?i=`${Math.round(n)}%`:e=!0,t("VProgressCircular",{props:{color:"primary",indeterminate:e,rotate:-90,size:64,value:n,width:4}},i)}let e,h,y;return r?(e=c,h="success",y=d):n?(e=s,h="error",y=o):(e=p,i&&(h="primary"),y=g),t("VIcon",{style:e,props:{color:h,disabled:l,large:!0}},y)})()])}},on:{load:u}})}};function o(t,e,i){return Math.min(Math.max(t,e),i)}var s={get(){return Math.round(o(this.scaledRotatedInternalImageWidthDifference*this.dirtyOriginLeft,this.computedMinCroppingLeft,this.computedMaxCroppingLeft))},set(t){let{scaledRotatedInternalImageWidthDifference:e}=this;this.dirtyOriginLeft=e?t/e:.5}},d={get(){return Math.round(o(this.scaledRotatedInternalImageHeightDifference*this.dirtyOriginTop,this.computedMinCroppingTop,this.computedMaxCroppingTop))},set(t){let{scaledRotatedInternalImageHeightDifference:e}=this;this.dirtyOriginTop=e?t/e:.5}};var c={get(){return o(this.dirtyScaling,this.computedMinScaling,this.computedMaxScaling)},set(t){this.dirtyScaling=t}};var g={checkeredBackground:function(){return[`url('data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2 2" fill-opacity="0.2"><rect x="1" width="1" height="1"/><rect y="1" width="1" height="1"/></svg>')}')`,"center center / 16px 16px","repeat","#fff"].join(" ")},computedMaxCroppingLeft:function(){return Math.max(0,this.scaledRotatedInternalImageWidthDifference)},computedMaxCroppingTop:function(){return Math.max(0,this.scaledRotatedInternalImageHeightDifference)},computedMaxScaling:function(){return Math.max(this.imageMaxScaling,this.computedMinScaling)},computedMinCroppingLeft:function(){return Math.min(0,this.scaledRotatedInternalImageWidthDifference)},computedMinCroppingTop:function(){return Math.min(0,this.scaledRotatedInternalImageHeightDifference)},computedMinScaling:function(){switch(this.imageMinScaling){case"cover":return Math.max(this.relativeRotatedInternalImageWidth,this.relativeRotatedInternalImageHeight);case"contain":return Math.min(this.relativeRotatedInternalImageWidth,this.relativeRotatedInternalImageHeight)}return 0},croppingLeft:s,croppingTop:d,relativeRotatedInternalImageHeight:function(){return this.imageHeight/this.rotatedInternalImageHeight},relativeRotatedInternalImageWidth:function(){return this.imageWidth/this.rotatedInternalImageWidth},rotatedInternalImageHeight:function(){return this.rotated?this.internalImageWidth:this.internalImageHeight},rotatedInternalImageWidth:function(){return this.rotated?this.internalImageHeight:this.internalImageWidth},scaledRotatedInternalImageHeight:function(){return Math.round(this.scaling*this.rotatedInternalImageHeight)},scaledRotatedInternalImageHeightDifference:function(){return this.imageHeight-this.scaledRotatedInternalImageHeight},scaledRotatedInternalImageWidth:function(){return Math.round(this.scaling*this.rotatedInternalImageWidth)},scaledRotatedInternalImageWidthDifference:function(){return this.imageWidth-this.scaledRotatedInternalImageWidth},scaling:c,updateImageData:function(){let{croppingLeft:t,croppingTop:e,debounce:i,flippedHorizontally:n,flippedVertically:a,imageBackgroundColor:r,imageFormat:l,imageHeight:o,imageQuality:s,imageWidth:d,internalImageData:c,internalImageHeight:g,internalImageWidth:p,rotated:u,scaling:h}=this;return setTimeout((()=>{let i;if(c){let f=new Image;f.src=c;let y=document.createElement("canvas"),m=y.getContext("2d");y.width=d,y.height=o,r&&(m.fillStyle=r,m.fillRect(0,0,d,o)),m.translate(t,e),m.scale(h,h),u&&(m.translate(g,0),m.rotate(Math.PI/2)),n&&(m.translate(p,0),m.scale(-1,1)),a&&(m.translate(0,g),m.scale(1,-1)),m.drawImage(f,0,0),n&&(m.translate(d,0),m.scale(-1,1)),a&&(m.translate(0,o),m.scale(1,-1)),i=y.toDataURL(`image/${l}`,s)}else i=null;this.imageData=i}),i)}},p="VImageInput";var u={clear:function(){this.internalImageData=null},flipHorizontally:function(){this.rotated?this.flippedVertically=!this.flippedVertically:this.flippedHorizontally=!this.flippedHorizontally,this.dirtyOriginLeft=1-this.dirtyOriginLeft},flipVertically:function(){this.rotated?this.flippedHorizontally=!this.flippedHorizontally:this.flippedVertically=!this.flippedVertically,this.dirtyOriginTop=1-this.dirtyOriginTop},load:function(t){if(this.imageData!==t){let e=new Image;e.addEventListener("load",(()=>{let i=e.naturalWidth,n=e.naturalHeight;this.internalImageData=i&&n?t:null,this.internalImageWidth=i,this.internalImageHeight=n,this.flippedHorizontally=!1,this.flippedVertically=!1,this.rotated=!1,this.scaling=0,this.dirtyOriginLeft=.5,this.dirtyOriginTop=.5})),e.src=t}},onPan:function(t){this.croppingLeft+=t.x-t.previousX,this.croppingTop+=t.y-t.previousY},rotateClockwise:function(){this.rotated?(this.rotated=!1,this.flippedHorizontally=!this.flippedHorizontally,this.flippedVertically=!this.flippedVertically):this.rotated=!0;let{dirtyOriginTop:t}=this;this.dirtyOriginTop=this.dirtyOriginLeft,this.dirtyOriginLeft=1-t},rotateCounterClockwise:function(){this.rotated?this.rotated=!1:(this.rotated=!0,this.flippedHorizontally=!this.flippedHorizontally,this.flippedVertically=!this.flippedVertically);let{dirtyOriginLeft:t}=this;this.dirtyOriginLeft=this.dirtyOriginTop,this.dirtyOriginTop=1-t},scaleTo:function(t){this.scaling=t}},h={type:Boolean,default:!1},f={type:Boolean,default:!1},y={type:Boolean,default:!1},m={type:Boolean,default:!1},I={type:Boolean,default:!1},v={type:Boolean,default:!0},S={type:Boolean,default:!0},C={type:Boolean,default:!0},M={type:Boolean,default:!0},b={type:Boolean,default:!0};var w={name:p,components:{MyActionButton:t,MyClearButton:{functional:!0,render:function(t,e){let{parent:i}=e;return t("MyActionButton",{props:{icon:i.clearIcon,iconStyle:i.clearIconStyle},on:{click:i.clear}})}},MyFileUpload:l,MyFlipHorizontallyButton:{functional:!0,render:function(t,e){let{parent:i}=e;return t("MyActionButton",{props:{icon:i.flipHorizontallyIcon,iconStyle:i.flipHorizontallyIconStyle},on:{click:i.flipHorizontally}})}},MyFlipVerticallyButton:{functional:!0,render:function(t,e){let{parent:i}=e;return t("MyActionButton",{props:{icon:i.flipVerticallyIcon,iconStyle:i.flipVerticallyIconStyle},on:{click:i.flipVertically}})}},MyRotateClockwiseButton:{functional:!0,render:function(t,e){let{parent:i}=e;return t("MyActionButton",{props:{icon:i.rotateClockwiseIcon,iconStyle:i.rotateClockwiseIconStyle},on:{click:i.rotateClockwise}})}},MyRotateCounterClockwiseButton:{functional:!0,render:function(t,e){let{parent:i}=e;return t("MyActionButton",{props:{icon:i.rotateCounterClockwiseIcon,iconStyle:i.rotateCounterClockwiseIconStyle},on:{click:i.rotateCounterClockwise}})}},MyScalingSlider:e},props:{clearable:h,clearIcon:{type:String,default:"$clear"},clearIconStyle:Object,debounce:{type:Number,default:0},disabled:f,errorIcon:{type:String,default:"$error"},errorIconStyle:Object,flipHorizontallyIcon:{type:String,default:"mdi-flip-horizontal"},flipHorizontallyIconStyle:Object,flipVerticallyIcon:{type:String,default:"mdi-flip-vertical"},flipVerticallyIconStyle:Object,fullHeight:y,fullWidth:m,actionFlipHorizontal:v,actionFlipVertical:S,actionRotateClockwise:C,actionRotateCounterClockwise:M,accept:{type:String,default:"image/*"},scalingSlider:b,imageBackgroundColor:String,imageFormat:{type:String,default:"png"},imageHeight:{type:Number,default:256},imageMaxScaling:{type:Number,default:1},imageMinScaling:{type:String,default:"cover"},imageQuality:{},imageWidth:{type:Number,default:256},name:String,overlayBackgroundColor:{type:String,default:"rgba(0,0,0,0.5)"},overlayBorderColor:{type:String,default:"#fff"},overlayBorderWidth:{type:String,default:"4px"},overlayPadding:{type:String,default:"50px"},readonly:I,rotateClockwiseIcon:{type:String,default:"mdi-rotate-right"},rotateClockwiseIconStyle:Object,rotateCounterClockwiseIcon:{type:String,default:"mdi-rotate-left"},rotateCounterClockwiseIconStyle:Object,successIcon:{type:String,default:"$success"},successIconStyle:Object,uploadIcon:{type:String,default:"mdi-upload"},uploadIconStyle:Object,value:String,backgroundColor:{},maxScaling:{},minScaling:{},rotateCounterclockwiseIcon:{},rotateCounterclockwiseIconStyle:{},scalingSliderColor:{}},data:function(){return{dirtyOriginLeft:.5,dirtyOriginTop:.5,dirtyScaling:0,fileInfo:null,flippedHorizontally:!1,flippedVertically:!1,imageData:null,internalImageData:null,internalImageHeight:0,internalImageWidth:0,rotated:!1}},computed:g,watch:{imageData:function(t){this.$emit("input",t)},updateImageData:function(t,e){clearTimeout(e)},value:{handler(t){t?this.load(t):this.clear()},immediate:!0}},created:function(){let{$props:t,constructor:e}=this,{warn:i}=e.super.util;Object.entries({imageBackgroundColor:"backgroundColor",imageMaxScaling:"maxScaling",imageMinScaling:"minScaling",rotateCounterClockwiseIcon:"rotateCounterclockwiseIcon",rotateCounterClockwiseIconStyle:"rotateCounterclockwiseIconStyle"}).forEach((e=>{let[n,a]=e;void 0!==t[a]&&i(`[${p}]: The property '${a}' has been renamed to '${n}'.`)})),["scalingSliderColor"].forEach((e=>{void 0!==t[e]&&i(`[${p}]: The property '${e}' has been removed.`)}))},methods:u,render:function(t){return t("div",{style:{display:["-ms-inline-grid","inline-grid"],gridColumns:"1fr auto",gridRows:"1fr auto",gridTemplateColumns:"1fr auto",gridTemplateRows:"1fr auto",...this.fullHeight?{height:"100%"}:{},...this.fullWidth?{width:"100%"}:{}}},[t("div",{style:{gridColumn:1,gridRow:1,overflow:"hidden",position:"relative"}},[t("div",{style:{alignItems:"center",background:this.checkeredBackground,display:"flex",height:"100%",justifyContent:"center",overflow:"hidden",padding:`calc(${this.overlayPadding} + ${this.overlayBorderWidth})`,position:"relative",width:"100%",zIndex:0,...this.internalImageData||this.readonly?{}:{opacity:0,pointerEvents:"none",visibility:"hidden"}},...this.internalImageData?this.disabled||this.readonly?{}:{directives:[{name:"Claw",arg:"pan",value:this.onPan}]}:{}},[t("div",{style:{boxShadow:`0 0 4000px 4000px ${this.overlayBackgroundColor}`,maxHeight:"100%",maxWidth:"100%",outline:`${this.overlayBorderWidth} solid ${this.overlayBorderColor}`,pointerEvents:"none"}},[t("div",{style:{height:`${this.imageHeight}px`,position:"relative",width:`${this.imageWidth}px`,zIndex:-1,...this.imageBackgroundColor?{backgroundColor:this.imageBackgroundColor}:{}}},[...this.internalImageData?[t("img",{style:{display:"block",pointerEvents:"none",position:"absolute",transform:[`translate(${this.croppingLeft}px,${this.croppingTop}px)`,`scale(${this.scaling})`,...this.rotated?[`translateX(${this.internalImageHeight}px)`,"rotate(90deg)"]:[],...this.flippedVertically?[`translateY(${this.internalImageHeight}px)`,"scaleY(-1)"]:[],...this.flippedHorizontally?[`translateX(${this.internalImageWidth}px)`,"scaleX(-1)"]:[]].join(" "),transformOrigin:"0 0"},attrs:{src:this.internalImageData}})]:[],...this.internalImageData&&this.imageData?[t("input",{attrs:{name:this.name,type:"hidden",value:this.imageData}})]:[]])])]),...this.internalImageData||this.readonly?[]:[t("MyFileUpload",{style:{bottom:0,left:0,position:"absolute",right:0,top:0},on:{load:t=>{let{file:{lastModified:e,name:i,size:n,type:a},result:r}=t;this.$emit("file-info",{name:i,size:n,type:a,lastModified:e}),this.load(r)}}})]]),t("div",{style:{display:"flex",gridColumn:1,gridRow:2,justifyContent:"center",...this.internalImageData?{}:{opacity:0,pointerEvents:"none",visibility:"hidden"}}},[...this.readonly?[]:[].concat(this.actionFlipHorizontal?[t("MyFlipHorizontallyButton")]:[]).concat(this.actionFlipVertical?[t("MyFlipVerticallyButton")]:[]).concat(this.actionRotateClockwise?[t("MyRotateClockwiseButton")]:[]).concat(this.actionRotateCounterClockwise?[t("MyRotateCounterClockwiseButton")]:[]).concat([t("VSpacer")]),...this.clearable?[t("MyClearButton")]:[]]),t("div",{style:{gridColumn:1,gridRow:3,...this.internalImageData?{}:{opacity:0,pointerEvents:"none",visibility:"hidden"}}},[...this.readonly?[]:this.scalingSlider?[t("MyScalingSlider")]:[]])])}};return w}));
